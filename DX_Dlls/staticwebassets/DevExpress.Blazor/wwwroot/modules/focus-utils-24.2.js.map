{"version":3,"file":"focus-utils-24.2.js","sources":["../../Scripts/focus-utils.ts"],"sourcesContent":["import { KeyCode, KeyUtils } from \"@devexpress/utils/lib/utils/key\";\r\nimport { FocusableElementsSelector } from \"./constants\";\r\nimport { disposeEvents, registerDisposableEvents } from \"./disposable\";\r\nimport { LogicalTreeHelper } from \"./utils/logicaltreehelper\";\r\nexport const FocusHiddenAttributeName = \"data-dx-focus-hidden\";\r\nexport function addFocusHiddenAttribute(element) {\r\n    element.setAttribute(FocusHiddenAttributeName, \"\");\r\n}\r\nexport function removeFocusHiddenAttribute(element) {\r\n    element.removeAttribute(FocusHiddenAttributeName);\r\n}\r\nexport function containsFocusHiddenAttribute(element) {\r\n    return element.getAttribute(FocusHiddenAttributeName) !== null;\r\n}\r\nexport function attachEventsForFocusHiding(mainElement) {\r\n    let _mainElement = mainElement;\r\n    function onGlobalClick(e) {\r\n        const isScreenReaderEvent = e.type === \"mousedown\" && e.detail === 0;\r\n        const alreadyHidden = _mainElement === null || _mainElement === void 0 ? void 0 : _mainElement.hasAttribute(FocusHiddenAttributeName);\r\n        if (isScreenReaderEvent || !_mainElement || alreadyHidden)\r\n            return;\r\n        if (LogicalTreeHelper.containsElement(_mainElement, e.target))\r\n            addFocusHiddenAttribute(_mainElement);\r\n    }\r\n    function onFocusOut(e) {\r\n        if (!_mainElement)\r\n            return;\r\n        const relatedTarget = e.relatedTarget;\r\n        if (relatedTarget && !LogicalTreeHelper.containsElement(_mainElement, relatedTarget) && document.hasFocus())\r\n            removeFocusHiddenAttribute(_mainElement);\r\n    }\r\n    function onKeyDown(e) {\r\n        if (!_mainElement)\r\n            return;\r\n        if (KeyUtils.getEventKeyCode(e) === KeyCode.Tab)\r\n            removeFocusHiddenAttribute(_mainElement);\r\n    }\r\n    const documentElement = document.documentElement;\r\n    documentElement.addEventListener(\"touchstart\", onGlobalClick);\r\n    documentElement.addEventListener(\"mousedown\", onGlobalClick);\r\n    _mainElement.addEventListener(\"keydown\", onKeyDown);\r\n    _mainElement.addEventListener(\"focusout\", onFocusOut);\r\n    return () => {\r\n        documentElement.removeEventListener(\"touchstart\", onGlobalClick);\r\n        documentElement.removeEventListener(\"mousedown\", onGlobalClick);\r\n        _mainElement === null || _mainElement === void 0 ? void 0 : _mainElement.removeEventListener(\"keydown\", onKeyDown);\r\n        _mainElement === null || _mainElement === void 0 ? void 0 : _mainElement.removeEventListener(\"focusout\", onFocusOut);\r\n        _mainElement = null;\r\n    };\r\n}\r\nexport function initFocusHidingEvents(mainElement) {\r\n    if (!mainElement)\r\n        return;\r\n    disposeEvents(mainElement);\r\n    const unsubscribe = attachEventsForFocusHiding(mainElement);\r\n    registerDisposableEvents(mainElement, unsubscribe);\r\n}\r\nexport function isFocusableElement(element) {\r\n    return element !== null && element.matches(FocusableElementsSelector);\r\n}\r\nexport function hasClosestFocusableElement(element) {\r\n    return element !== null && element.closest(FocusableElementsSelector) !== null;\r\n}\r\nexport default {\r\n    initFocusHidingEvents\r\n};\r\n"],"names":["KeyUtils","KeyCode"],"mappings":"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"}
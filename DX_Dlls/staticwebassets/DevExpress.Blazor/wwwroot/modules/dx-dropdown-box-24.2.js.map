{"version":3,"file":"dx-dropdown-box-24.2.js","sources":["../../Scripts/editors/dropdown/keyboard-navigation/drop-down-box-kbd-strategy.ts","../../Scripts/editors/dropdownbox/dx-dropdown-box.ts"],"sourcesContent":["import { DropDownRootKbdStrategy } from \"./drop-down-root-kbd-strategy\";\r\nimport { EditorDropDownKbdStrategy } from \"./editor-drop-down-kbd-strategy\";\r\nimport { FocusUtils } from \"../../../common/keyboard-navigation/keyboard-navigation-utils\";\r\nimport { DropDownCssClasses } from \"../../dropdownbase/dx-dropdown-css-classes\";\r\nimport { KeyCode, KeyUtils } from \"@devexpress/utils/lib/utils/key\";\r\nimport EventHelper from \"../../../utils/eventhelper\";\r\nimport { DxKeyboardNavigatorTagName } from \"../../../common/keyboard-navigation/dx-keyboard-navigator\";\r\nimport { DomUtils } from \"@devexpress/utils/lib/utils/dom\";\r\nexport class DropDownBoxRootKbdStrategy extends DropDownRootKbdStrategy {\r\n    createPopupStrategy(navigator, targetElement) {\r\n        return new DropDownBoxDropDownKbdStrategy(navigator, targetElement, this);\r\n    }\r\n}\r\nconst navigatorInitializationTimeout = 50;\r\nexport class DropDownBoxDropDownKbdStrategy extends EditorDropDownKbdStrategy {\r\n    constructor(navigator, targetElement, parentStrategy) {\r\n        super(navigator, targetElement, parentStrategy);\r\n        this._focusableElements = [];\r\n        this._timeoutId = null;\r\n        this.boundWaitForNavigatorInitialization = this.waitForNavigatorInitialization.bind(this);\r\n    }\r\n    get editDropDownElement() {\r\n        return this.targetElement.querySelector(`.${DropDownCssClasses.ClassName}`);\r\n    }\r\n    updateFocusableElementsList() {\r\n        if (this.editDropDownElement) {\r\n            const dropDownFocusableElements = FocusUtils.findFocusableElements(this.editDropDownElement);\r\n            this._focusableElements = dropDownFocusableElements.length > 0 ? dropDownFocusableElements : [this.editDropDownElement];\r\n        }\r\n    }\r\n    get focusableElements() {\r\n        return this._focusableElements;\r\n    }\r\n    handlePopupShown() {\r\n        super.handlePopupShown();\r\n        this.addDropDownElementsEventSubscriptions();\r\n        const keyboardNavigator = this.editDropDownElement.querySelector(DxKeyboardNavigatorTagName);\r\n        if (!keyboardNavigator || keyboardNavigator.initialized) {\r\n            this.handlePopupShownInternal();\r\n            return;\r\n        }\r\n        this.waitForNavigatorInitialization(keyboardNavigator, this.handlePopupShownInternal.bind(this));\r\n    }\r\n    handlePopupClosed() {\r\n        super.handlePopupClosed();\r\n        this.targetElement.removeEventListener(\"focus\", this.boundDropDownElementFocusHandler);\r\n        if (this.editDropDownElement)\r\n            this.editDropDownElement.removeEventListener(\"focus\", this.boundEditDropDownElementFocusHandler);\r\n    }\r\n    addDropDownElementsEventSubscriptions() {\r\n        if (!this.boundDropDownElementFocusHandler)\r\n            this.boundDropDownElementFocusHandler = this.dropDownElementFocusHandler.bind(this);\r\n        this.targetElement.addEventListener(\"focus\", this.boundDropDownElementFocusHandler);\r\n        if (this.editDropDownElement) {\r\n            if (!this.boundEditDropDownElementFocusHandler)\r\n                this.boundEditDropDownElementFocusHandler = this.editDropDownElementFocusHandler.bind(this);\r\n            this.editDropDownElement.addEventListener(\"focus\", this.boundEditDropDownElementFocusHandler);\r\n        }\r\n    }\r\n    waitForNavigatorInitialization(navigator, callback) {\r\n        if (this._timeoutId)\r\n            clearTimeout(this._timeoutId);\r\n        if (document.activeElement === this.targetElement) {\r\n            if (!navigator.initialized)\r\n                this._timeoutId = setTimeout(() => this.boundWaitForNavigatorInitialization(navigator, callback), navigatorInitializationTimeout);\r\n            else\r\n                callback();\r\n        }\r\n    }\r\n    handlePopupShownInternal() {\r\n        this.updateFocusableElementsList();\r\n        this.tryFocusFirstFocusableElement();\r\n    }\r\n    tryFocusFirstFocusableElement() {\r\n        if (this.focusableElements.length > 0)\r\n            FocusUtils.focusElement(this.focusableElements[0]);\r\n    }\r\n    tryFocusLastFocusableElement() {\r\n        if (this.focusableElements.length > 0)\r\n            FocusUtils.focusElement(this.focusableElements[this.focusableElements.length - 1]);\r\n    }\r\n    handleKeyDown(evt) {\r\n        if (KeyUtils.getEventKeyCode(evt) === KeyCode.Tab && this.focusableElements.length <= 1) {\r\n            EventHelper.markHandled(evt);\r\n            return false;\r\n        }\r\n        return super.handleKeyDown(evt);\r\n    }\r\n    onDropDownEditorPointerDownHandler() {\r\n        if (DomUtils.isItParent(this.targetElement, document.activeElement))\r\n            return;\r\n        super.onDropDownEditorPointerDownHandler();\r\n    }\r\n    dropDownElementFocusHandler(e) {\r\n        this.tryFocusFirstFocusableElement();\r\n    }\r\n    editDropDownElementFocusHandler(e) {\r\n        this.tryFocusLastFocusableElement();\r\n    }\r\n}\r\n","import { __decorate } from \"tslib\";\r\nimport { customElement } from \"lit/decorators.js\";\r\nimport adaptiveDropdownComponents from \"../../popup/adaptivedropdowncomponents\";\r\nimport { DxDropDownBase } from \"../dropdownbase/dx-dropdown-base3\";\r\nimport { dropDownBoxTagName } from \"../constants\";\r\nimport { DropDownBoxRootKbdStrategy } from \"../dropdown/keyboard-navigation/drop-down-box-kbd-strategy\";\r\nlet DxDropdownBox = class DxDropdownBox extends DxDropDownBase {\r\n    constructor() {\r\n        super();\r\n    }\r\n    processPointerDown(e) {\r\n        const isEditBoxElement = e.target === this.editBoxElement;\r\n        const isNotFocusableElementInMainElementTemplate = this.editBoxTemplateElement && this.editBoxTemplateElement.contains(e.target) && !this.isFocusableElementInMainElementTemplate(e.target);\r\n        if (!this.isDropDownOpen && (isEditBoxElement || isNotFocusableElementInMainElementTemplate))\r\n            this.tryOpenDropDown();\r\n        return super.processPointerDown(e);\r\n    }\r\n    createKeyboardStrategy() {\r\n        return new DropDownBoxRootKbdStrategy(this);\r\n    }\r\n    connectedCallback() {\r\n        super.connectedCallback();\r\n    }\r\n    disconnectedCallback() {\r\n        super.disconnectedCallback();\r\n    }\r\n};\r\nDxDropdownBox = __decorate([\r\n    customElement(dropDownBoxTagName)\r\n], DxDropdownBox);\r\nexport { DxDropdownBox };\r\nfunction loadModule() { }\r\nexport default { loadModule, adaptiveDropdownComponents };\r\n"],"names":["KeyUtils","KeyCode","DomUtils","customElement"],"mappings":"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"}
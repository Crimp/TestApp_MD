{"version":3,"file":"dx-context-menu-24.2.js","sources":["../../Scripts/context-menu/keyboard-navigation/popup-keyboard-strategy.ts","../../Scripts/context-menu/keyboard-navigation/root-keyboard-strategy.ts","../../Scripts/context-menu/dx-context-menu.ts"],"sourcesContent":["import { MenuItem, PopupMenuKeyboardStrategy } from \"../../common/keyboard-navigation/dropdown/dropdown-keyboard-strategy\";\r\nimport { hasPopup } from \"../../menu/keyboard-navigation/utils\";\r\nimport { FocusUtils } from \"../../common/keyboard-navigation/keyboard-navigation-utils\";\r\nimport { DropDownAction, DropDownActionRequestEvent } from \"../../common/keyboard-navigation/dropdown/events\";\r\nimport { KeyboardNavigatorIsReadyAtribute } from \"../../menu/keyboard-navigation/menu-keyboard-strategy\";\r\nconst ContextMenuItemSelector = \".dxbl-context-menu-item, .dxbl-context-menu-template\";\r\nexport class DxContextMenuPopupKeyboardStrategy extends PopupMenuKeyboardStrategy {\r\n    constructor(navigator, targetElement, parentStrategy) {\r\n        super(navigator, targetElement);\r\n        this._parentStrategy = parentStrategy;\r\n        this.selectedItemIndex = -1;\r\n    }\r\n    get parentStrategy() {\r\n        return this._parentStrategy;\r\n    }\r\n    initialize() {\r\n        super.initialize();\r\n        this.targetElement.setAttribute(KeyboardNavigatorIsReadyAtribute, \"\");\r\n    }\r\n    activate() {\r\n        if (this.selectedItemIndex >= 0)\r\n            super.activate();\r\n    }\r\n    updateSelectedItemByIndex(index) {\r\n        if (index >= 0)\r\n            super.updateSelectedItemByIndex(index);\r\n    }\r\n    queryItems() {\r\n        return this.queryItemsBySelector(ContextMenuItemSelector);\r\n    }\r\n    onActiveStateChanged(isActive) {\r\n        if (!isActive) {\r\n            if (this.selectedItemElement)\r\n                FocusUtils.removeTabIndex(this.selectedItemElement);\r\n            FocusUtils.removeTabIndex(this.targetElement);\r\n        }\r\n    }\r\n    doAction(evt) {\r\n        if (this.selectedItemElement) {\r\n            this.doClick(this.selectedItemElement, evt);\r\n            if (hasPopup(this.selectedItemElement))\r\n                this.openSubMenu(MenuItem.First);\r\n        }\r\n    }\r\n    async openSubMenu(focusedItem) {\r\n        this.requestSubMenuOpen();\r\n        const strategy = await this.waitSubMenuShown();\r\n        if (focusedItem === MenuItem.Last)\r\n            strategy.focusLastItem();\r\n        else\r\n            strategy.focusFirstItem();\r\n    }\r\n    handlePopupShown() {\r\n        this.parentStrategy.onSubMenuShown(this);\r\n        this.focusContainer();\r\n    }\r\n    handlePopupClosed() {\r\n        this.parentStrategy.onSubMenuClosed(this);\r\n    }\r\n    onSubMenuClosed(strategy) {\r\n        super.onSubMenuClosed(strategy);\r\n        this.focusContainer();\r\n    }\r\n    focusContainer() {\r\n        const focusableElements = FocusUtils.findFocusableElements(this.targetElement);\r\n        if (focusableElements.length > 0)\r\n            FocusUtils.focusElement(focusableElements[0]);\r\n    }\r\n    createSubMenuStrategy(navigator, targetElement) {\r\n        return new DxContextMenuSubMenuKeyboardStrategy(navigator, targetElement, this);\r\n    }\r\n}\r\nexport class DxContextMenuRootMenuKeyboardStrategy extends DxContextMenuPopupKeyboardStrategy {\r\n    closeSelf() {\r\n        if (hasPopup(this.selectedItemElement)) {\r\n            this.openSubMenu(MenuItem.Last);\r\n            return true;\r\n        }\r\n        else\r\n            return false;\r\n    }\r\n}\r\nexport class DxContextMenuSubMenuKeyboardStrategy extends DxContextMenuPopupKeyboardStrategy {\r\n    closeSelf() {\r\n        const parentElement = this.targetElement.placementTargetElement;\r\n        if (parentElement) {\r\n            parentElement.dispatchEvent(new DropDownActionRequestEvent(DropDownAction.Collapse));\r\n            this.parentStrategy.updateSelectedItemByChildElement(parentElement);\r\n            this.parentStrategy.focusSelectedItem();\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n}\r\n","import { KeyCode, KeyUtils } from \"@devexpress/utils/lib/utils/key\";\r\nimport { KeyboardNavigationStrategy } from \"../../common/keyboard-navigation/keyboard-navigation-strategy\";\r\nimport { containsFocus } from \"../../menu/keyboard-navigation/utils\";\r\nimport { PopupKeyboardStrategyCreatingEvent } from \"../../popup/popup\";\r\nimport { DxContextMenuRootMenuKeyboardStrategy } from \"./popup-keyboard-strategy\";\r\nexport class DxContextMenuRootStrategy extends KeyboardNavigationStrategy {\r\n    constructor(navigator, targetElement) {\r\n        super(navigator, targetElement);\r\n        this._prevActiveElement = null;\r\n        this.boundHandlePopupKeyboardStrategyCreating = this.handlePopupKeyboardStrategyCreating.bind(this);\r\n        this.targetElement.addEventListener(PopupKeyboardStrategyCreatingEvent.eventName, this.boundHandlePopupKeyboardStrategyCreating);\r\n    }\r\n    queryItems() {\r\n        return this.queryItemsBySelector(\".dxbl-dropdown-dialog\");\r\n    }\r\n    onSubMenuShown(_strategy) {\r\n        if (!this._prevActiveElement)\r\n            this._prevActiveElement = document.activeElement;\r\n    }\r\n    onSubMenuClosed(strategy) {\r\n        if (!strategy.targetElement.isConnected || containsFocus(strategy.targetElement))\r\n            this.tryRestoreFocusedElement();\r\n    }\r\n    handlePopupKeyboardStrategyCreating(evt) {\r\n        evt.detail.factory = {\r\n            createPopup: (navigator, targetElement) => new DxContextMenuRootMenuKeyboardStrategy(navigator, targetElement, this)\r\n        };\r\n        evt.stopPropagation();\r\n    }\r\n    handleKeyDown(evt) {\r\n        const keyCode = KeyUtils.getEventKeyCode(evt);\r\n        if (keyCode === KeyCode.Tab && !this.nestedContentSelected) {\r\n            this.performShortcutEvent(evt);\r\n            if (evt.shiftKey)\r\n                this.leaveBackward();\r\n            else\r\n                this.leaveForward();\r\n            return true;\r\n        }\r\n        return super.handleKeyDown(evt);\r\n    }\r\n    tryRestoreFocusedElement() {\r\n        if (this._prevActiveElement && this._prevActiveElement instanceof HTMLElement) {\r\n            this._prevActiveElement.focus();\r\n            this._prevActiveElement = null;\r\n        }\r\n    }\r\n}\r\n","import { __decorate } from \"tslib\";\r\nimport { customElement } from \"lit/decorators.js\";\r\nimport { DxKeyboardNavigator, DxKeyboardNavigatorTagName } from \"../common/keyboard-navigation/dx-keyboard-navigator\";\r\nimport SingleSlotElementBase from \"../common/single-slot-element-base\";\r\nimport { DxContextMenuRootStrategy } from \"./keyboard-navigation/root-keyboard-strategy\";\r\nlet DxContextMenu = class DxContextMenu extends SingleSlotElementBase {\r\n    constructor() {\r\n        super();\r\n        this._keyboardNavigator = null;\r\n        this.bindedOnChanged = this.onChanged.bind(this);\r\n        this._observer = new MutationObserver(this.bindedOnChanged);\r\n    }\r\n    onChanged(mutations, _observer) {\r\n        mutations === null || mutations === void 0 ? void 0 : mutations.forEach(mutation => {\r\n            mutation.addedNodes.forEach(node => {\r\n                if (node instanceof DxKeyboardNavigator) {\r\n                    this._keyboardNavigator = node;\r\n                    this.initializeKeyboardNavigation();\r\n                }\r\n            });\r\n        });\r\n    }\r\n    connectedCallback() {\r\n        this._keyboardNavigator = this.querySelector(DxKeyboardNavigatorTagName);\r\n        if (this._keyboardNavigator)\r\n            this.initializeKeyboardNavigation();\r\n        else\r\n            this._observer.observe(this, { childList: true });\r\n    }\r\n    initializeKeyboardNavigation() {\r\n        if (this._keyboardNavigator && \"initialized\" in this._keyboardNavigator && !this._keyboardNavigator.initialized)\r\n            this._keyboardNavigator.initialize(this, new DxContextMenuRootStrategy(this._keyboardNavigator, this));\r\n    }\r\n    disconnectedCallback() {\r\n        var _a;\r\n        this._observer.disconnect();\r\n        (_a = this._keyboardNavigator) === null || _a === void 0 ? void 0 : _a.disposeComponent();\r\n    }\r\n};\r\nDxContextMenu = __decorate([\r\n    customElement(\"dxbl-context-menu\")\r\n], DxContextMenu);\r\nexport { DxContextMenu };\r\nfunction loadModule() { }\r\nexport default { loadModule };\r\n"],"names":["KeyUtils","KeyCode","customElement"],"mappings":"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"}
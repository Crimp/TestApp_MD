{"version":3,"file":"dropdown-menu-keyboard-strategy-24.2.js","sources":["../../Scripts/menu/keyboard-navigation/dropdown-menu-keyboard-strategy.ts"],"sourcesContent":["import { KeyCode, KeyUtils } from \"@devexpress/utils/lib/utils/key\";\r\nimport { MenuItem, PopupMenuKeyboardStrategy } from \"../../common/keyboard-navigation/dropdown/dropdown-keyboard-strategy\";\r\nimport { DropDownAction, DropDownActionRequestEvent } from \"../../common/keyboard-navigation/dropdown/events\";\r\nimport { removeFocusHiddenAttribute } from \"../../focus-utils\";\r\nimport { TemplatedItemAttribute } from \"./menu-keyboard-strategy\";\r\nimport { containsFocus, hasPopup, Semaphore } from \"./utils\";\r\nimport { FocusUtils } from \"../../common/keyboard-navigation/keyboard-navigation-utils\";\r\n// TODO: some members duplicate members from the DxDropDownMenuOwnerKeyboardStrategy class.\r\n// To use this class as a parent, it is need to refactor the DxDropDownMenuKeyboardStrategy class.\r\nexport class DropDownMenuKeyboardStrategyBase extends PopupMenuKeyboardStrategy {\r\n    constructor(navigator, targetElement, menuItemSelector, parentStrategy, isTransitContainer = false) {\r\n        super(navigator, targetElement, isTransitContainer);\r\n        this._focusSemaphore = new Semaphore();\r\n        this._menuItemSelector = menuItemSelector;\r\n        this._parentStrategy = parentStrategy;\r\n    }\r\n    get parentStrategy() {\r\n        return this._parentStrategy;\r\n    }\r\n    get menuItemSelector() {\r\n        return this._menuItemSelector;\r\n    }\r\n    queryItems() {\r\n        return this.queryItemsBySelector(this._menuItemSelector);\r\n    }\r\n    doAction(evt) {\r\n        this.doClick(this.selectedItemElement, evt);\r\n        if (hasPopup(this.selectedItemElement))\r\n            this.focusSubMenuItemAsync(MenuItem.First);\r\n    }\r\n    handleKeyDown(evt) {\r\n        return this._focusSemaphore.doAllowedFunc(() => {\r\n            const keyCode = KeyUtils.getEventKeyCode(evt);\r\n            if (keyCode === KeyCode.Right && this.subMenuStrategy && containsFocus(this.targetElement)) {\r\n                this.subMenuStrategy.focusFirstItem();\r\n                return true;\r\n            }\r\n            return super.handleKeyDown(evt);\r\n        });\r\n    }\r\n    openSubMenu(focusedItem) {\r\n        this.openSubMenuAsync(focusedItem);\r\n    }\r\n    async openSubMenuAsync(focusedItem) {\r\n        this.requestSubMenuOpen();\r\n        await this.focusSubMenuItemAsync(focusedItem);\r\n    }\r\n    async focusSubMenuItemAsync(menuItem) {\r\n        const strategy = await this.waitSubMenuShown();\r\n        removeFocusHiddenAttribute(strategy.targetElement);\r\n        if (menuItem === MenuItem.Last)\r\n            strategy.focusLastItem();\r\n        else\r\n            strategy.focusFirstItem();\r\n    }\r\n    closeSubMenu() {\r\n        this.selectedItemElement.dispatchEvent(new DropDownActionRequestEvent(DropDownAction.Collapse));\r\n    }\r\n    handlePopupShown() {\r\n        this._parentStrategy.onSubMenuShown(this);\r\n    }\r\n    handlePopupClosed() {\r\n        this._parentStrategy.onSubMenuClosed(this);\r\n    }\r\n    focusFirstItem() {\r\n        if (this.subMenuStrategy)\r\n            this.subMenuStrategy.focusFirstItem();\r\n        else\r\n            super.focusFirstItem();\r\n    }\r\n    focusLastItem() {\r\n        if (this.subMenuStrategy)\r\n            this.subMenuStrategy.focusLastItem();\r\n        else\r\n            super.focusLastItem();\r\n    }\r\n    focusItem(index) {\r\n        this._focusSemaphore.doAllowedAction(() => {\r\n            super.focusItem(index);\r\n        });\r\n    }\r\n    restoreFocus() {\r\n        this._focusSemaphore.doAllowedAction(() => {\r\n            super.restoreFocus();\r\n        });\r\n    }\r\n    focusSelectedItem() {\r\n        this._focusSemaphore.doIfAllowed(() => {\r\n            super.focusSelectedItem();\r\n        });\r\n    }\r\n    hasTransitContainer(element) {\r\n        return element.hasAttribute(TemplatedItemAttribute);\r\n    }\r\n    findFocusableElements() {\r\n        return FocusUtils.findFocusableElements(this.selectedItemElement).filter(x => !x.classList.contains(\"dxbl-dropdown-dialog\"));\r\n    }\r\n    leaveTransitContainer(direction) {\r\n        super.leaveTransitContainer(direction);\r\n        this.parentStrategy.closeSubMenu();\r\n    }\r\n}\r\nexport class DxMenuDropDownRootMenuKeyboardStrategy extends DropDownMenuKeyboardStrategyBase {\r\n    createSubMenuStrategy(navigator, targetElement) {\r\n        return new DxMenuDropDownSubMenuKeyboardStrategy(navigator, targetElement, this.menuItemSelector, this, this.hasTransitContainer(targetElement));\r\n    }\r\n    closeSelf() {\r\n        return false;\r\n    }\r\n}\r\nexport class DxMenuDropDownSubMenuKeyboardStrategy extends DropDownMenuKeyboardStrategyBase {\r\n    createSubMenuStrategy(navigator, targetElement) {\r\n        return new DxMenuDropDownSubMenuKeyboardStrategy(navigator, targetElement, this.menuItemSelector, this);\r\n    }\r\n    closeSelf() {\r\n        this.parentStrategy.closeSubMenu();\r\n        return true;\r\n    }\r\n}\r\n"],"names":["KeyUtils","KeyCode"],"mappings":"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"}
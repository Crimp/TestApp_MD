{"version":3,"file":"portal-24.2.js","sources":["../../Scripts/popup/getPopupRootSingleton.ts","../../Scripts/popup/portal.ts"],"sourcesContent":["import { dxPopupRootTagName } from \"./constants\";\r\nclass PopupContainer {\r\n    _doWithElementCheck(action) {\r\n        const popup = document.querySelector(dxPopupRootTagName);\r\n        return action(popup !== null && popup !== void 0 ? popup : this._createPopupElement());\r\n    }\r\n    _createPopupElement() {\r\n        const rootEl = document.createElement(dxPopupRootTagName);\r\n        document.body.appendChild(rootEl);\r\n        return rootEl;\r\n    }\r\n    constructor() {\r\n        this._rootElementPromise = customElements.whenDefined(dxPopupRootTagName);\r\n    }\r\n    assign(portal) {\r\n        this._rootElementPromise.then(() => this._doWithElementCheck(x => x.assign(portal)));\r\n    }\r\n    getPopup(parentBranchId) {\r\n        return this._rootElementPromise.then(() => this._doWithElementCheck(x => x.getPopup(parentBranchId)));\r\n    }\r\n    release(portal) {\r\n        this._rootElementPromise.then(() => this._doWithElementCheck(x => x.release(portal)));\r\n    }\r\n    async subscribeCaptureManager(element) {\r\n        await this._rootElementPromise;\r\n        return this._doWithElementCheck(x => x.subscribe(element));\r\n    }\r\n}\r\nconst popupContainerSingleton = new PopupContainer();\r\nexport function getPopupRootSingleton() {\r\n    return popupContainerSingleton;\r\n}\r\n","import { __decorate } from \"tslib\";\r\nimport DataQaUtils from \"../utils/data-qa-utils\";\r\nimport { LitElement } from \"lit\";\r\nimport { customElement, property } from \"lit/decorators.js\";\r\nimport { getPopupRootSingleton } from \"./getPopupRootSingleton\";\r\nimport { GlobalConstants } from \"../common/const\";\r\nexport const dxPortalTagName = \"dxbl-portal\";\r\nclass PortableElementsContext {\r\n    constructor(elements) {\r\n        this.elements = elements;\r\n    }\r\n}\r\nexport class PortableElementsChangedEvent extends CustomEvent {\r\n    constructor(detail) {\r\n        super(PortableElementsChangedEvent.eventName, {\r\n            detail,\r\n            bubbles: true\r\n        });\r\n    }\r\n}\r\nPortableElementsChangedEvent.eventName = \"dxbl-portable-elements-changed\";\r\nlet DxPortal = class DxPortal extends LitElement {\r\n    constructor() {\r\n        super(...arguments);\r\n        this._portable = null;\r\n        this._elementsPorted = false;\r\n        this.slotChangedHandler = this.handleSlotChange.bind(this);\r\n        this.boundOnFocusInHandler = this.handleFocusIn.bind(this);\r\n        this._reassignPortal = () => getPopupRootSingleton().assign(this);\r\n    }\r\n    get portable() {\r\n        return this._portable;\r\n    }\r\n    createRenderRoot() {\r\n        const root = super.createRenderRoot();\r\n        const slot = document.createElement(\"slot\");\r\n        root.appendChild(slot);\r\n        slot.addEventListener(\"slotchange\", this.slotChangedHandler);\r\n        return root;\r\n    }\r\n    handleSlotChange(e) {\r\n        const slot = e.target;\r\n        const elements = slot.assignedNodes();\r\n        if (this._elementsPorted && elements.length === 0)\r\n            return;\r\n        this.assignElements(elements);\r\n        this._elementsPorted = true;\r\n    }\r\n    assignElements(elements) {\r\n        this._portable = elements;\r\n        this.raiseElementsChanged(elements);\r\n    }\r\n    connectedCallback() {\r\n        var _a;\r\n        super.connectedCallback();\r\n        DataQaUtils.setLoaded(this);\r\n        getPopupRootSingleton().assign(this);\r\n        if ((_a = window.Blazor) === null || _a === void 0 ? void 0 : _a.addEventListener)\r\n            window.Blazor.addEventListener(\"enhancedload\", this._reassignPortal);\r\n        this.addEventListener(\"focusin\", this.boundOnFocusInHandler, { capture: true });\r\n    }\r\n    handleFocusIn(evt) {\r\n        const popup = document.querySelector(`:not(.dxbl-popup-portal)[branch-id=${this.branchId}]`);\r\n        if (popup)\r\n            popup.activatePopupContent();\r\n    }\r\n    disconnectedCallback() {\r\n        var _a;\r\n        super.disconnectedCallback();\r\n        getPopupRootSingleton().release(this);\r\n        DataQaUtils.removeLoaded(this);\r\n        if ((_a = window.Blazor) === null || _a === void 0 ? void 0 : _a.removeEventListener)\r\n            window.Blazor.removeEventListener(\"enhancedload\", this._reassignPortal);\r\n        this.removeEventListener(\"focusin\", this.boundOnFocusInHandler, { capture: true });\r\n    }\r\n    raiseElementsChanged(elements) {\r\n        const event = new PortableElementsChangedEvent(new PortableElementsContext(elements));\r\n        this.dispatchEvent(event);\r\n    }\r\n    updated(_) {\r\n        if (!this.branchId && !this.hasAttribute(GlobalConstants.virtualElementAttributeName))\r\n            throw new Error(\"branch-id must be specified\");\r\n    }\r\n};\r\n__decorate([\r\n    property({ type: String, attribute: \"branch-id\" })\r\n], DxPortal.prototype, \"branchId\", void 0);\r\nDxPortal = __decorate([\r\n    customElement(dxPortalTagName)\r\n], DxPortal);\r\nexport { DxPortal };\r\nexport function init() {\r\n}\r\nexport default { init, DxPortal, dxPortalTagName };\r\n"],"names":["LitElement","property","customElement"],"mappings":"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"}